{"version":3,"kind":"Notebook","sha256":"a578c76209c9086fcfde9c18cc9e43d343125d3c1a28b05a8135ee6afdf71fa4","slug":"n-2-3-hist-equalization","location":"/capitolo2/n_2_3_hist_equalization.ipynb","dependencies":[],"frontmatter":{"title":"Equalizzazione dell’istogramma - Notebook 2.3","content_includes_title":false,"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"n_2_3_hist_equalization.ipynb","url":"/elab_bioimmagini-site/build/n_2_3_hist_equalizat-e64db11141e8d91607d740462c7ccf83.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import delle librerie necessarie per la simulazione","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j5wnBhsrBM"}],"key":"lcONPsb8NC"}],"key":"aw2ZeTlt49"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport imageio","key":"VHuWnNwGk5"},{"type":"outputs","id":"4jCPnV9uObWdLxiDRu2dx","children":[],"key":"CowEBuju7Y"}],"key":"a9mWNN6zrv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import dati DICOM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JzAGn4kNb1"}],"identifier":"import-dati-dicom","label":"Import dati DICOM","html_id":"import-dati-dicom","implicit":true,"key":"rJyX9gOsTF"}],"key":"peB7vZQgjO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"I = imageio.v2.imread(\"../data/phantom_15.dcm\")\n","key":"D02G5X2MXO"},{"type":"outputs","id":"vrmeRxaaM_RmOwpPZxe7J","children":[],"key":"heClGRuiSx"}],"key":"ws3qweTh8v"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Equalizzazione dell’istogramma","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U4Ry5UjRbC"}],"identifier":"equalizzazione-dellistogramma","label":"Equalizzazione dell’istogramma","html_id":"equalizzazione-dellistogramma","implicit":true,"key":"mK9sCkjs3x"}],"key":"ln3HnhrjoW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# (opzionale) se I può avere negativi, porta il minimo a 0\nI = I - I.min()\n\n# livelli (assumo immagine discreta intera)\np = int(I.max()) + 1\nN = I.size\nprint(\"N =\", N)\n\n# --- escludo gli zeri prima di equalizzare ---\nmask = I > 0\nNnz = int(mask.sum())\nprint(\"N (non-zero) =\", Nnz)\n\n# histogram SOLO sui pixel > 0\ncounts = np.bincount(I[mask].astype(np.int64), minlength=p)\ncounts[0] = 0\n\n# CDF normalizzata\nCDF = np.cumsum(counts)\nCDF = CDF / CDF[-1]  # ora è in [0,1]\n\n# visualizza (PDF e CDF)\nfig, ax = plt.subplots(1, 2, figsize=(10, 4))\nax[0].imshow(I, cmap=\"gray\")\nax[0].set_title(\"Immagine originale (shifted)\")\n\nax[1].plot(counts / counts.sum(), label=\"PDF (I>0)\")\nax[1].plot(CDF, label=\"CDF (I>0)\")\nax[1].set_title(\"Istogramma e CDF (esclusi gli zeri)\")\nax[1].legend()\nplt.show()\n\n# LUT per equalizzazione\nLUT = np.floor((p - 1) * CDF).astype(np.uint16)\n\n# applico solo dove I>0\nIeq = np.zeros_like(I)\nIeq[mask] = LUT[I[mask].astype(np.int64)]\n\n# histogram equalizzata \ncounts_eq = np.bincount(Ieq[mask].astype(np.int64), minlength=p)\n\nfig, ax = plt.subplots(1, 2, figsize=(10, 4))\nax[0].imshow(Ieq, cmap=\"gray\")\nax[0].set_title(\"Immagine equalizzata (solo I>0)\")\n\nax[1].plot(counts_eq / counts_eq.sum())\nax[1].set_title(\"Istogramma equalizzato (solo I>0)\")\nplt.show()\n","key":"G5S89UEMuy"},{"type":"outputs","id":"Y-Hn60sFVsGvJo0ejiVno","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"N = 262144\nN (non-zero) = 205578\n"},"children":[],"key":"KrAHRE42yk"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_3205/62409158.py:2: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  I = I - I.min()\n/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_3205/62409158.py:10: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  mask = I > 0\n"},"children":[],"key":"zEAxByOrWt"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"001938dd2507a2a640511f1cd4705fe7","path":"/elab_bioimmagini-site/build/001938dd2507a2a640511f1cd4705fe7.png"},"text/plain":{"content":"<Figure size 1000x400 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"idizMvyEaJ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"be32ff62b345da730ee004aad26d73b1","path":"/elab_bioimmagini-site/build/be32ff62b345da730ee004aad26d73b1.png"},"text/plain":{"content":"<Figure size 1000x400 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"f1k4dhHHO4"}],"key":"yyzTUIa7bl"}],"key":"I9Eq3ffMXk"}],"key":"eSFfHN6UUK"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Esempi di filtraggio - Notebook 2.2","url":"/n-2-2-esempi-filtraggio","group":"Capitolo2"},"next":{"title":"Esercitazione 2: stima dell’effetto di diversi tipi di filtraggio su alcune misure di qualità dell’immagine biomedica","url":"/z-2-1-esercitazione","group":"Capitolo2"}}},"domain":"http://localhost:3000"}