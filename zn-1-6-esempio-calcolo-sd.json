{"version":3,"kind":"Notebook","sha256":"a49a87f24f2da476aa3df4a06b26e1dbeb65c16ff2185de17ceb6354412fcead","slug":"zn-1-6-esempio-calcolo-sd","location":"/capitolo1/zn_1_6_esempio_calcolo_sd.ipynb","dependencies":[],"frontmatter":{"title":"Esempio calcolo SD su fantoccio e immagine reale - Notebook 1.6","content_includes_title":false,"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"zn_1_6_esempio_calcolo_sd.ipynb","url":"/elab_bioimmagini-site/build/zn_1_6_esempio_calco-3ff555224ee0b6b646a0fe92913ddf7f.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import delle librerie necessarie per la simulazione.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I7kPZEeHjz"}],"key":"wBK7WuQfAK"}],"key":"Q5iOTAq0Lj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport scipy.ndimage as ndi\nimport pydicom","key":"qXAAD8Cdlu"},{"type":"outputs","id":"mvZyZlxRcqDjPrLCK2kj5","children":[],"key":"zz4hGcDyBC"}],"key":"rSDkci6rV5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Stima SD su immagine simulata.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k8SZSAPFOP"}],"identifier":"stima-sd-su-immagine-simulata","label":"Stima SD su immagine simulata.","html_id":"stima-sd-su-immagine-simulata","implicit":true,"key":"uJqBkL3rHL"}],"key":"Uns1vsJd7s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# create ideal image with 6 patterns\ndim = 512\nimage = np.zeros([dim,dim])\nimage[:,:] = 50\nimage[49:100, 49:100] = 120\nimage[100:180, 100:449] = 200\nimage[199:499, 199:349] = 90\nimage[229:269, 229:269] = 250\nimage[4:399, 449:499] = 150\n\n# add gaussian noise\nsigma = 5\nimageN = image + sigma*np.random.randn(dim,dim)\n\n# histogram\ncounts, bins = np.histogram(imageN, bins = 256)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(imageN, cmap = 'gray')\nax[1].hist(bins[:-1], bins, weights=counts)\n\n# get map of standard deviation\nimageF = ndi.generic_filter(imageN, np.std, size = 5)\ncountsF, binsF = np.histogram(imageF, bins = 256)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(imageF, cmap = 'gray')\nax[1].hist(binsF[:-1], binsF, weights=countsF)\n\n# print estimated values for SD\nsigmaMean = np.mean(imageF, None)\nsigmaMedian = np.median(imageF, None)\nid = np.argmax(countsF)\nsigmaMax = binsF[id]\nplt.show()\n\nprint(\"Assigned sigma: \",sigma)\nprint(\"Sigma Mean: \",sigmaMean)\nprint(\"Sigma Median: \",sigmaMedian)\nprint(\"Sigma Hist: \",sigmaMax)\n","key":"BqJKp9KXSj"},{"type":"outputs","id":"Urp7VNo8xYlAS5JFsIZZs","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eaf776496b6d3c9610e61e35e155a33b","path":"/elab_bioimmagini-site/build/eaf776496b6d3c9610e61e35e155a33b.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Bn54zDEECN"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"17b8ef89e03318381c9dfe3e3e963973","path":"/elab_bioimmagini-site/build/17b8ef89e03318381c9dfe3e3e963973.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"LTONVFbQc9"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Assigned sigma:  5\nSigma Mean:  6.503379770313196\nSigma Median:  4.853447826563725\nSigma Hist:  4.520810377610957\n"},"children":[],"key":"KDrOhTl64C"}],"key":"lQKnVM4XrO"}],"key":"yuEKawusze"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Stima SD su immagine DICOM.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lsodkJ8lpa"}],"identifier":"stima-sd-su-immagine-dicom","label":"Stima SD su immagine DICOM.","html_id":"stima-sd-su-immagine-dicom","implicit":true,"key":"WqQ6xQNSkv"}],"key":"pzPU6s5d4d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = pydicom.dcmread('../data/phantom.dcm')\nprint(\"Patient ID\", ds.PatientID)\n\nI = ds.pixel_array\n\nnz = np.where(I != 0)[0]\n\n# ROI based analysis\ncenterO = (120,80)\ncenterW = (120,120)\ncenterB = (50,50)\nradius = 8\n\nfig, ax = plt.subplots()\nax.imshow(I, cmap = 'gray')\ncircleO = plt.Circle(centerO, radius, color = 'r', fill = False)\nax.add_patch(circleO)\ncircleO = plt.Circle(centerW, radius, color = 'g', fill = False)\nax.add_patch(circleO)\ncircleO = plt.Circle(centerB, radius, color = 'b', fill = False)\nax.add_patch(circleO)\n\nx, y = np.meshgrid(np.arange(ds.Columns), np.arange(ds.Rows))\nmaskO = (x - centerO[0])**2 + (y - centerO[1])**2 <= radius**2\nmaskW = (x - centerW[0])**2 + (y - centerW[1])**2 <= radius**2\nmaskB = (x - centerB[0])**2 + (y - centerB[1])**2 <= radius**2\n\nid = np.where(maskO != 0)\nstdO = np.std(I[id], None)\n\nid = np.where(maskW != 0)\nstdW = np.std(I[id], None)\n\nid = np.where(maskB != 0)\nstdB = np.std(I[id], None)\n\nplt.show()\nprint(\"Stima basata su ROI:\")\nprint(\"Sigma Oil: \",stdO)\nprint(\"Sigma Water: \",stdW)\nprint(\"Sigma Background: \",stdB)\nprint(\"Sigma Background corrected: \",stdB*1.526)\n\n# histogram based analysis\nsdmap = ndi.generic_filter(I, np.std, size = 3)\ncounts, bins = np.histogram(sdmap[nz], bins = 128)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(sdmap, cmap = 'gray')\nax[1].hist(bins[:-1], bins, weights=counts)\n\nsigmaMean = np.mean(sdmap[nz], None)\nsigmaMedian = np.median(sdmap[nz], None)\nid = np.argmax(counts)\nsigmaMax = bins[id]\nplt.show()\nprint(\"stima basata sulla mappa di SD:\")\nprint(\"Sigma Mean: \",sigmaMean)\nprint(\"Sigma Median: \",sigmaMedian)\nprint(\"Sigma Hist: \",sigmaMax)\n\n\n# use only high signal part of the data\nnHigh = np.where(I>100)[0]\nsdmap = ndi.generic_filter(I, np.std, size = 9)\ncounts, bins = np.histogram(sdmap[nHigh], bins = 128)\n\nsigmaMean = np.mean(sdmap[nHigh], None)\nsigmaMedian = np.median(sdmap[nHigh], None)\nid = np.argmax(counts)\nsigmaMax = bins[id]\nplt.show()\n\nprint(\"stima basata sulla mappa di SD utilizzando solo le parti ad alto valore di SD:\")\nprint(\"Sigma Mean: \",sigmaMean)\nprint(\"Sigma Median: \",sigmaMedian)\nprint(\"Sigma Hist: \",sigmaMax)\n","key":"u26ep4oDEY"},{"type":"outputs","id":"_6WO0rAK_XYNWUdOjif-Q","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Patient ID I Test firb pet-MRI\n"},"children":[],"key":"mZxJoIjauV"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7e732df1980d67eb63044bacaf30544d","path":"/elab_bioimmagini-site/build/7e732df1980d67eb63044bacaf30544d.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"UkfmI2DIlW"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Stima basata su ROI:\nSigma Oil:  14.247686582736174\nSigma Water:  12.884378713050324\nSigma Background:  9.489095224875806\nSigma Background corrected:  14.48035931316048\n"},"children":[],"key":"rF70755Y4y"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4c78ff9481d021a2dfa325b4b51dd8ad","path":"/elab_bioimmagini-site/build/4c78ff9481d021a2dfa325b4b51dd8ad.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"CxfyJnDgoV"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"stima basata sulla mappa di SD:\nSigma Mean:  19.34662833727554\nSigma Median:  9.0\nSigma Hist:  5.34375\nstima basata sulla mappa di SD utilizzando solo le parti ad alto valore di SD:\nSigma Mean:  55.81278083913939\nSigma Median:  13.0\nSigma Hist:  8.859375\n"},"children":[],"key":"u8TLhj2jFw"}],"key":"UNqgbv4jD1"}],"key":"jM9PL1hAk7"}],"key":"gH25ToaNvt"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Effetto della dimensione della ROI sulla stima di M e SD - Notebook 1.5","url":"/zn-1-5-test-m-sd","group":"Capitolo1"},"next":{"title":"Capitolo 2: Interpolazione, filtraggio e compressione","url":"/c21-interpolazione-filtraggio-e-compressione-compl","group":"Capitolo2"}}},"domain":"http://localhost:3000"}