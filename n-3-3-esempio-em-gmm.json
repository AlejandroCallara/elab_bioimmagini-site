{"version":3,"kind":"Notebook","sha256":"586bc236a9dbba76d1a4fd84425e74f4e7d7ea8a1f9183bcc6d59ef29bbaf686","slug":"n-3-3-esempio-em-gmm","location":"/capitolo3/n_3_3_esempio_em_gmm.ipynb","dependencies":[],"frontmatter":{"title":"Esempio di segmentazione con Gaussian Mixtures - Notebook 3.3","content_includes_title":false,"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"n_3_3_esempio_em_gmm.ipynb","url":"/elab_bioimmagini-site/build/n_3_3_esempio_em_gmm-4bf1ba24e67f803c3e2bf14a9ec3a0ef.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import delle librerie necessarie per la simulazione","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kEhQXUMa8c"}],"key":"JSWywqorqw"}],"key":"GfOVuCwjNJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.cluster import k_means\nfrom sklearn.mixture import GaussianMixture","key":"spn40FDIYY"},{"type":"outputs","id":"7Ey4MMa32JIXmaSxk4uxf","children":[],"key":"CV4hrsOuRh"}],"key":"G5TzYvdva3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Immagine simulata","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xyhiprFvIG"}],"key":"INGBuhEuSQ"}],"key":"O6FNwUk4ce"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dim = 512\ntissueMask = np.zeros((dim, dim), dtype = np.float32)\ntissueMask[:,:] = 1\ntissueMask[49:189,49:189] = 2\ntissueMask[199:499,199:349] = 3\n\nfig, ax = plt.subplots()\nax.imshow(tissueMask, cmap = \"gray\")\nax.set_title('image')\n\n# create 3 guassian distributions\nm1, m2, m3 = 50, 400, 200\nsd1, sd2, sd3 = 60, 40, 20\n\ndata1 = m1+sd1*np.random.randn(dim, dim) # signal distribution\ndata2 = m2+sd2*np.random.randn(dim, dim)\ndata3 = m3+sd3*np.random.randn(dim, dim)\nid1 = np.where(tissueMask == 1)\nid2 = np.where(tissueMask == 2)\nid3 = np.where(tissueMask == 3)\n\nimage = np.zeros_like(tissueMask)\nimage[id1] = data1[id1]\nimage[id2] = data2[id2]\nimage[id3] = data3[id3]\n\nfig, ax = plt.subplots()\nax.imshow(image, cmap = \"gray\")\nax.set_title(\"image\")","key":"wZSMwKvZeq"},{"type":"outputs","id":"sSiHuiNKkWDIfoC1iRLB2","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"290f192491f353d7fb185aad23064e9a","path":"/elab_bioimmagini-site/build/290f192491f353d7fb185aad23064e9a.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"P9J0TUhkrf"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"13c7cca3d967502849fae7f68ebd3b3e","path":"/elab_bioimmagini-site/build/13c7cca3d967502849fae7f68ebd3b3e.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"aztejixxf9"}],"key":"vP3mptSas7"}],"key":"HGiZVROF1h"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Fitting di ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"akhlRPp7Sv"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Gaussian Mixtures","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TubXBfCwqN"}],"key":"n9ak7iDWxU"},{"type":"text","value":" tramite algoritmo ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tB5m1eWbu0"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"EM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cRjxWDky37"}],"key":"BojgowvGNS"}],"key":"oysdAJN5oC"}],"key":"LOo57IT0pZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# probability of a tissue in the image\np1 = len(id1)/(dim*dim)\np2 = len(id2)/(dim*dim)\np3 = len(id3)/(dim*dim)\n\n# calculate histogram\nfig, ax = plt.subplots(1,2)\ncounts, bins = np.histogram(image, bins = 256)\nxcounts = bins[:-1] + np.diff(bins) / 2\nax[0].plot(xcounts,counts)\n\n# apply gaussian mixtures using kmeans as initial condition\nimage = image.reshape((-1,1))\ngmm = GaussianMixture(\n    n_components = 3, \n    max_iter = 100, \n    init_params = 'kmeans', \n    verbose = 1)\ngmm.fit(image)\n\nn_samples = len(image)\n\ndataGM1 = gmm.means_[0]+np.sqrt(gmm.covariances_[0])*np.random.randn(int(gmm.weights_[0] * n_samples)).flatten()\ndataGM2 = gmm.means_[1]+np.sqrt(gmm.covariances_[1])*np.random.randn(int(gmm.weights_[1] * n_samples)).flatten()\ndataGM3 = gmm.means_[2]+np.sqrt(gmm.covariances_[2])*np.random.randn(int(gmm.weights_[2] * n_samples)).flatten()\ndataGM = np.concatenate([dataGM1.T, dataGM2.T, dataGM3.T])\n\nhGM, edgesGM = np.histogram(dataGM, bins = 256)\nxGM = edgesGM[:-1] + np.diff(edgesGM) / 2\nax[1].plot(xcounts,counts)\nax[1].plot(xGM,hGM, color='r')\n","key":"Pafr8JmFt1"},{"type":"outputs","id":"qxRq3PGE02pR1bT2yDpAk","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Initialization 0\n  Iteration 10\nInitialization converged.\n"},"children":[],"key":"OVdbH21YGO"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"77e176092028f55c130bb3aafb462e45","path":"/elab_bioimmagini-site/build/77e176092028f55c130bb3aafb462e45.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"XIPez2qv03"}],"key":"aytE3LQy7k"}],"key":"VyXPjkATxw"}],"key":"Pw7Q699aV0"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Esempio di segmentazione con FCM - Notebook 3.2","url":"/n-3-2-esempio-fcm","group":"Capitolo3"},"next":{"title":"Esempio di clustering gerarchico - Notebook 3.4","url":"/n-3-4-hierarchical-clustering-example","group":"Capitolo3"}}},"domain":"http://localhost:3000"}