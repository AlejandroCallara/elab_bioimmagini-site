{"version":3,"kind":"Notebook","sha256":"7a090974e3ed9a7635cb560b8ccdb742fad77f953343352dd20b773db93f69f2","slug":"n-2-2-esempi-filtraggio","location":"/capitolo2/n_2_2_esempi_filtraggio.ipynb","dependencies":[],"frontmatter":{"title":"Esempi di filtraggio - Notebook 2.2","content_includes_title":false,"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"n_2_2_esempi_filtraggio.ipynb","url":"/elab_bioimmagini-site/build/n_2_2_esempi_filtrag-367cdbbf9b617d19cde7578ff53f5b49.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import delle librerie necessarie per la simulazione","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FHRSexN7ap"}],"key":"vlzUyuH2mp"}],"key":"iaDCz6wRCs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nimport scipy.ndimage as ndi\nimport pydicom\nimport os\nimport imageio\nfrom scipy.spatial.distance import euclidean","key":"AuE6Kg10Ys"},{"type":"outputs","id":"Yrgz59iMUT0sG0vgCDTGh","children":[],"key":"oNgT0FSnjd"}],"key":"RHeBFtUGem"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Lettura file DICOM","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w6GHUrhFcg"}],"identifier":"lettura-file-dicom","label":"Lettura file DICOM","html_id":"lettura-file-dicom","implicit":true,"key":"LYRdfxEawN"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Esempio di import di uno o più file DICOM e visualizzazione di una fetta del fantoccio","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SqfaW9n1B8"}],"key":"jxceVIOSGY"}],"key":"khmuhtHTEC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# set directory\ndirectory = '../data/Phantom_CT_PET/2-CT 2.5mm-5.464/'\n\n# get all files in directory\nfiles = sorted(os.listdir(directory))\n\n# get info from dicom\nds = pydicom.dcmread(directory + files[0])\nprint(\"Patient ID:\", ds.PatientID)\n\n# get size along 3 axis\nxSize = ds.Rows\nySize = ds.Columns\nzSize = len(files)\nprint(xSize, ySize, zSize)\n\n# get resolution\ndx = ds.PixelSpacing[0]\ndy = ds.PixelSpacing[1]\nloc1 = ds.ImagePositionPatient\nds2  = pydicom.dcmread(directory + files[1])\nloc2 = ds2.ImagePositionPatient\ndz = euclidean(loc1, loc2)\nprint(\"dimesioni del dato:\", dx, dy, dz)\n\n# import volume\nvol = imageio.volread(directory, 'DICOM')\nFOV = [dx*xSize,dy*ySize,dz*zSize]\nprint(\"FOV:\", FOV)\nprint(vol.shape)\n\n# get plane\nimg = vol[9,:,:]\nprint(img.shape)\n\n# original image\nfig, ax = plt.subplots()\nax.imshow(img, cmap = 'gray')\nax.set_title(\"immagine originale\")\nplt.show()","key":"KzVMlrdWJB"},{"type":"outputs","id":"9G54d2qp_w0dMfS8fUKye","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Patient ID: SNMCB04\n512 512 63\ndimesioni del dato: 0.683594 0.683594 2.5\nReading DICOM (examining files): 1/63 files (1.6%63/63 files (100.0%)\n  Found 1 correct series.\nReading DICOM (loading data): 63/63  (100.0%)\nFOV: [350.000128, 350.000128, 157.5]\n(63, 512, 512)\n(512, 512)\n"},"children":[],"key":"TOO3K1srZZ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"10fc56cee4c0c4367e8b0bd978893b16","path":"/elab_bioimmagini-site/build/10fc56cee4c0c4367e8b0bd978893b16.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"z3sALyKVhA"}],"key":"sMQrr4bRfZ"}],"key":"dzDmZuWzqg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtro a media mobile","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"El1yFcyBcY"}],"identifier":"filtro-a-media-mobile","label":"Filtro a media mobile","html_id":"filtro-a-media-mobile","implicit":true,"key":"JkYRuANNyZ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"è possibile cambiare la dimensione del filtro per apprezzarne l’effetto sull’immagine filtrata.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TbZydgfMMN"}],"key":"MS9j0u5gnu"}],"key":"hPOqMDud7G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# moving average filter\nweights = [[1/9, 1/9, 1/9],\n           [1/9, 1/9, 1/9],\n           [1/9, 1/9, 1/9]]\n\nimg_ma = ndi.convolve(img, weights)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_ma, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con media mobile\")\nax[1].imshow(img-img_ma, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()","key":"uTZTJdaWqt"},{"type":"outputs","id":"0icJ8l9Sn41usPw6aHgRX","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/296414372.py:11: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_ma, cmap = 'gray')\n"},"children":[],"key":"dpDrm5E0ay"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1493d30cc678513833ccb0091d2cf490","path":"/elab_bioimmagini-site/build/1493d30cc678513833ccb0091d2cf490.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"G6pvpuWcbz"}],"key":"EfqFKjY3s0"}],"key":"TM3ddBEv4C"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtro Gaussiano","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RQzAwHqnyY"}],"identifier":"filtro-gaussiano","label":"Filtro Gaussiano","html_id":"filtro-gaussiano","implicit":true,"key":"Jcl6Bllzyd"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"è possibile variare la dimensione del filtro e la ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UrOgTZqWBb"},{"type":"inlineMath","value":"\\sigma","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi></mrow><annotation encoding=\"application/x-tex\">\\sigma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span></span></span></span>","key":"YwzJNG6ITk"},{"type":"text","value":" per apprezzarne l’effetto sull’immagine filtrata.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"g5TgA0WFq9"}],"key":"AfU7cL70BH"}],"key":"Laf34ZGoSy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# gaussian average filter\nimg_gaussian = ndi.gaussian_filter(img, sigma = 3)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_gaussian, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con media gaussiana\")\nax[1].imshow(img-img_gaussian, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()","key":"GZ6hiCPfon"},{"type":"outputs","id":"cqn6MDf0Ur_6wnJbZ-xPm","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/351799351.py:7: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_gaussian, cmap = 'gray')\n"},"children":[],"key":"TUlyrRxtA6"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"84cf5650cd3f2cce2be99aa1432d3660","path":"/elab_bioimmagini-site/build/84cf5650cd3f2cce2be99aa1432d3660.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"lUigy9F6sx"}],"key":"iJC7kDTkuO"}],"key":"iwB5NZY3bB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtro mediano","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q5wLj4OIIG"}],"identifier":"filtro-mediano","label":"Filtro mediano","html_id":"filtro-mediano","implicit":true,"key":"t4MeZlJw2u"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"notare il mantenimento dei bordi rispetto al filtro a media mobile o a quello Gaussiano.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Of9Iu49kYr"}],"key":"iUedX4wkXd"}],"key":"j9M5MInTqD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# median filter\nimg_median = ndi.median_filter(img, size = 3)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_median, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con mediana\")\nax[1].imshow(img-img_median, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()","key":"q2VqLErHoj"},{"type":"outputs","id":"I4ECZEuNg7Z9GDZKJTFg_","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/2759418975.py:7: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_median, cmap = 'gray')\n"},"children":[],"key":"vyPixCzFYG"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4172ad29e6cd46729c08067ab13ab258","path":"/elab_bioimmagini-site/build/4172ad29e6cd46729c08067ab13ab258.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"JbSleWRJuq"}],"key":"l3RwiVI4Ak"}],"key":"dSXGP050pj"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtro di Sobel","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XAaIttLHKl"}],"identifier":"filtro-di-sobel","label":"Filtro di Sobel","html_id":"filtro-di-sobel","implicit":true,"key":"MMzGex49WT"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"esempio di filtro derivativo per enfatizzare i contorni.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iWgm5gxnhV"}],"key":"UBFxWpnZoU"}],"key":"EGdSPsdY50"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# sobel filter\nimg_sobel_0 = ndi.sobel(img, axis = 0)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_sobel_0, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con Sobel lungo l'asse 0\")\nax[1].imshow(img-img_sobel_0, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()\n\nimg_sobel_1 = ndi.sobel(img, axis = 1)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_sobel_1, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con Sobel lungo l'asse 1\")\nax[1].imshow(img-img_sobel_1, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()\n\nimg_sobel = np.sqrt(img_sobel_0**2 + img_sobel_1**2)\n\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_sobel, cmap = 'gray')\nax[0].set_title(\"immagine filtrata lungo entrambi gli assi\")\nax[1].imshow(img-img_sobel, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()","key":"d27N0WyQf9"},{"type":"outputs","id":"5GiNX8SnJkYTqukzQNZTM","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/862965885.py:7: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_sobel_0, cmap = 'gray')\n"},"children":[],"key":"aO68SbvmCQ"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"21dd1e463ca8d7ab2d77d3858c0b3d7c","path":"/elab_bioimmagini-site/build/21dd1e463ca8d7ab2d77d3858c0b3d7c.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"lR7P9uocWW"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/862965885.py:16: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_sobel_1, cmap = 'gray')\n"},"children":[],"key":"B8eHkvmtoS"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a7ebddd0d902e0a58f3766c2e736130","path":"/elab_bioimmagini-site/build/7a7ebddd0d902e0a58f3766c2e736130.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Uni6kBw5NC"},{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/862965885.py:20: RuntimeWarning: invalid value encountered in sqrt\n  img_sobel = np.sqrt(img_sobel_0**2 + img_sobel_1**2)\n/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/862965885.py:25: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_sobel, cmap = 'gray')\n"},"children":[],"key":"r2Q7edoZDj"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4f98d868fa58dd6075fbb81e0f669327","path":"/elab_bioimmagini-site/build/4f98d868fa58dd6075fbb81e0f669327.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Zc58oBPiNA"}],"key":"W2r9tOqDeF"}],"key":"VFmvDzrCs6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filtro laplaciano","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"de5qAdurwt"}],"identifier":"filtro-laplaciano","label":"Filtro laplaciano","html_id":"filtro-laplaciano","implicit":true,"key":"EI91VeLxqm"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"altro tipo di filtro derivativo. Notare le differenze con il filtro di Sobel.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fDznwIFqEq"}],"key":"C53k0QUtmO"}],"key":"shfNoes6RB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# laplace filter\nimg_laplace = ndi.laplace(img)\nfig, ax = plt.subplots(1,2)\nax[0].imshow(img_laplace, cmap = 'gray')\nax[0].set_title(\"immagine filtrata con Laplace\")\nax[1].imshow(img-img_laplace, cmap = 'gray')\nax[1].set_title(\"immagine differenza\")\nplt.show()","key":"xpS4HVENcq"},{"type":"outputs","id":"CycRIMrNalNtfPZZscRoY","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/var/folders/f2/szdn4h555wv3xkj5npgb1nqc0000gn/T/ipykernel_7633/1278184842.py:6: DeprecationWarning: __array_wrap__ must accept context and return_scalar arguments (positionally) in the future. (Deprecated NumPy 2.0)\n  ax[1].imshow(img-img_laplace, cmap = 'gray')\n"},"children":[],"key":"Dvqri9ovLl"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0bef992ede53795f476b1241fdf990a4","path":"/elab_bioimmagini-site/build/0bef992ede53795f476b1241fdf990a4.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"loxWh9kLyB"}],"key":"N5HBMPqohN"}],"key":"e3BwYNJDxS"}],"key":"FfoVWEaWAZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Esempi di interpolazione - Notebook 2.1","url":"/n-2-1-esempi-interpolazione","group":"Capitolo2"},"next":{"title":"Equalizzazione dell’istogramma - Notebook 2.3","url":"/n-2-3-hist-equalization","group":"Capitolo2"}}},"domain":"http://localhost:3000"}