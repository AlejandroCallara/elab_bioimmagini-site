{"version":3,"kind":"Article","sha256":"f61c4a34b1fe8ae3aa2517b040630d0101d3571ac2f07d549f262323ad2393a8","slug":"n-3-8-mser-example","location":"/capitolo3/n_3_8_mser_example.md","dependencies":[],"frontmatter":{"title":"Esempio di algoritmo mser - Codice 3.8","content_includes_title":false,"numbering":{"title":{"offset":1}},"exports":[{"format":"md","filename":"n_3_8_mser_example.md","url":"/elab_bioimmagini-site/build/n_3_8_mser_example-770b07266aeb1f7512c8cd0452b4c1c6.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Nel seguente codice è simulato il comportamento dell’algoritmo mser.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"B0ooAf8Y2w"}],"key":"rWjfRaGEPI"},{"type":"code","lang":"python","value":"# -*- coding: utf-8 -*-\n\"\"\"\nCreated on Mon Sep 16 15:11:20 2024\n\n@author: alejandro\n\"\"\"\n\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport cv2\nimport pydicom\nfrom scipy.ndimage import label\nimport time\n\n# read file\ndb = pydicom.dcmread('./data/phantom.dcm')\nimage = db.pixel_array\n\nfig, ax = plt.subplots(1, 2)\nax[0].imshow(image, cmap = 'gray')\nax[1].plot(image[np.round(db.Rows/2).astype(int),:])\n\n# simplified MSER algorithm\npixel_list= np.sort(image.reshape(-1,1))\ntmp = np.zeros_like(image)\n\nG = np.unique(pixel_list)\n\nn_labels = np.zeros_like(G)\nlabels = np.zeros((len(G), *image.shape))\nfig, ax = plt.subplots(1,2)\nfor g in range(len(G)):\n    ax[0].cla()\n    ax[1].cla()\n    idx = np.where(image == G[g])\n    tmp[idx] = 1\n    l, num = label(tmp, structure=np.ones((3, 3))) \n    labels[g] = l\n    n_labels[g] = num\n    \n    ax[0].imshow(l)\n    ax[1].plot(np.arange(len(G)), np.log(n_labels +1))\n    # drawing updated values\n    fig.canvas.draw()\n    \n    # This will run the GUI event\n    # loop until all UI events\n    # currently waiting have been processed\n    fig.canvas.flush_events()\n\n    time.sleep(0.001)\n    \n    # show the figure\n    fig.show()\n    \n# follow background area\n# fig, ax = plt.subplots()\nmaps = np.zeros((len(G), *image.shape))\nareaBK = np.zeros(len(G))\n\nfor g in range(len(G)):\n    current_lab = np.squeeze(labels[g,:,:])\n    area = np.zeros(n_labels[g])\n    for n in range(n_labels[g]):\n        idx = np.where(current_lab == (n+1))\n        area[n] = len(idx[0])\n    idmax = np.argmax(area)\n    id1 = np.where(current_lab == (idmax+1))\n    areaBK[g] = len(id1[0])\n    maps[g][idx] = 255\n    \n    # ax.imshow(np.squeeze(maps[g,:,:]))\n    # # drawing updated values\n    # fig.canvas.draw()\n    # fig.canvas.flush_events()\n    # time.sleep(0.001)\n    \n    # fig.show()\n    \nfig, ax = plt.subplots(1, 2)\nax[0].plot(areaBK)\nvariazione = 50*np.diff(areaBK)\nax[1].plot(variazione)\n\nidx = np.where(variazione == 0)\n\n\nmser = cv2.MSER_create()\nregionsc= mser.detectRegions(cv2.cvtColor(image, cv2.COLOR_BGR2GRAY))","position":{"start":{"line":4,"column":1},"end":{"line":94,"column":1}},"key":"gDg1aJV1xB"}],"key":"himmofnZCF"}],"key":"wXcRpr6ntA"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Esempio di segmentazione ai contorni - Notebook 3.6","url":"/n-3-6-seg-contorni","group":"Capitolo3"},"next":{"title":"Esempio di component tree - Notebook 3.9","url":"/n-3-9-connected-tree-example","group":"Capitolo3"}}},"domain":"http://localhost:3000"}