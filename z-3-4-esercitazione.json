{"version":3,"kind":"Article","sha256":"4daae27de012122342ecc3258e30cbe6efb3e7b7c977ad34aee715aa55d945f8","slug":"z-3-4-esercitazione","location":"/capitolo3/z_3_4_esercitazione.md","dependencies":[],"frontmatter":{"title":"Esercitazione 6: segmentazione dell’albero bronchiale","content_includes_title":false,"numbering":{"title":{"offset":1}},"thumbnail":"/elab_bioimmagini-site/build/image-69-79e5d2e04504089bd21f085580c7a7cc.png","exports":[{"format":"md","filename":"z_3_4_esercitazione.md","url":"/elab_bioimmagini-site/build/z_3_4_esercitazione-3c4d63259d4961b347e170e6a75f9148.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Contesto clinico","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xDaTZvHzsO"}],"identifier":"contesto-clinico","label":"Contesto clinico","html_id":"contesto-clinico","implicit":true,"key":"YNApRxOIwA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"L’analisi dell’albero polmonare è importante in pazienti con insufficienza respiratoria, nei quali per varie patologie si può avere un restringimento del lume bronchiale o una stenosi dei tratti terminali dell’albero. In un soggetto normale le dimensioni delle varie componenti dell’albero sono quelle in Figura 3.69.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rLJ0Ogrn4Q"}],"key":"tokWPGz21K"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-69-79e5d2e04504089bd21f085580c7a7cc.png","alt":"albero","key":"i8O1XIvQMK","urlSource":"./images/image-69.png"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Figura 3.69. Dimensione delle componenti dell’albero bronchiale per un soggetto sano.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ohG6Eej5vR"}],"key":"wSLhhINgld"}],"key":"la8Qpeabcg"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Attraverso immagini CT ad alta risoluzione è possibile misurare nel singolo paziente la struttura e le dimensioni dell’albero e verificare la presenza di patologie (Figura 3.70). A questo scopo è necessario ricavare la struttura dell’albero per verificare la lunghezza dei vari tratti (seconda colonna della tabella) e misurare il diametro dei vari tratti (prima colonna della tabella).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"SZqM4kz5uE"}],"key":"EUyI3PrT6y"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-70-a64a9081fb88eb04295b4a8642ce145c.png","alt":"segm-albero","key":"ll6phejpul","urlSource":"./images/image-70.png"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Figura 3.70. Esempio di segmentazione dell’albero bronchiale.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"czN8eVwsck"}],"key":"mNPBKzbtVn"}],"key":"euC99TwbSw"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Una demo di un software di questo tipo è visibile a ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"u5oVVI5Kdi"},{"type":"link","url":"https://www.youtube.com/watch?v=y0CB6Ko_QF4","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"https://​www​.youtube​.com​/watch​?v​=​y0CB6Ko​_QF4","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"BtJAupKNyd"}],"urlSource":"https://www.youtube.com/watch?v=y0CB6Ko_QF4","key":"nvmjCkwwGb"},{"type":"text","value":".\nQuesto tipo di software si basa su operazioni di segmentazione dell’albero bronchiale e di estrazione della struttura dell’albero attraverso algoritmi di ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"uxs2biUzDx"},{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"skeletonization","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"s4r28dvIUu"}],"key":"OUnOi2Pt1q"},{"type":"text","value":".","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"gcBl17rdp2"}],"key":"EImQ11eRMA"},{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Esercitazione","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"JvUi0EXgF2"}],"identifier":"esercitazione","label":"Esercitazione","html_id":"esercitazione","implicit":true,"key":"SV38hI0d6C"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"L’esercitazione prevede lo sviluppo di una versione semplificata del software.\nIn particolare vogliamo ottenere due obiettivi:","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"IzyOszkwOn"}],"key":"dypiAaBo17"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Estrarre dall’immagine l’albero bronchiale (quindi il lume dei bronchi)","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"qq6oYPItWh"}],"key":"eXOZ7b97y4"}],"key":"qFX4QWdRWK"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Misurare il diametro dell’albero scendendo lungo i bronchi.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"wyL9KLwk7l"}],"key":"cbKcsDrKkg"}],"key":"wtSGYzxmIU"}],"key":"QZIqqDQGxv"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Naturalmente faremo delle ipotesi semplificative rispetto alle tecniche effettivamente utilizzate nei software clinici. In particolare le immagini fornite coprono solo la prima biforcazione.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"Bxq0KMzonb"}],"key":"VusJQ3Bizf"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"La flow chart del software sarà costituita da una serie di blocchi come quelli riportati in Figura 3.71.","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"sIYK1kWIvq"}],"key":"Bdl1bvuMgC"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-71-e5dcbb42b0e5458d8952feeeca84a472.png","alt":"flowchart-segm-albero","key":"JTVwEYB9TC","urlSource":"./images/image-71.png"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Figura 3.71. Esempio di flowchart per la segmentazione dell’albero bronchiale.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"O6zleFb7AM"}],"key":"GrlePmDnuR"}],"key":"mwnmtxKtfD"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Il set di dati utilizzato proviene dal Cancer Imaging Archive (","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"wuL6T8BSbj"},{"type":"link","url":"https://www.cancerimagingarchive.net/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"https://​www​.cancerimagingarchive​.net/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"rfJCMEQFOe"}],"urlSource":"https://www.cancerimagingarchive.net/","key":"LTKacbVTET"},{"type":"text","value":"), una repository di dati biomedici anonimizzati che possono essere utilizzati liberamente a scopi di ricerca. I dati sono “labellati” da operatori esperti e quindi possono anche costituire una base di conoscenza per la validazione di algoritmi di analisi dell’immagine. Nel nostro caso utilizziamo le immagini di un paziente dello studio LIDC-IDRI (","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"jci6ocHZmk"},{"type":"link","url":"https://wiki.cancerimagingarchive.net/pages/viewpage.action?pageId=1966254","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"https://​wiki​.cancerimagingarchive​.net​/pages​/viewpage​.action​?pageId​=​1966254","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"DJ4KCf9LTN"}],"urlSource":"https://wiki.cancerimagingarchive.net/pages/viewpage.action?pageId=1966254","key":"fctUIsjaqP"},{"type":"text","value":") dedicato all’identificazioni dei noduli polmonari. Nel nostro caso invece l’obiettivo è studiare l’albero bronchiale del paziente.\nIl set di dati è una immagine 3D del torace composta da 148 slice ognuna memorizzata in un file DICOM. Rispetto al volume originale abbiamo la sezione che comprende solo la trachea e i bronchi. I dati DICOM sono memorizzati come numeri di Hounsfield, per cui per leggere correttamente i dati bisogna fare riferimento ai campi RescaleSlope ed RescaleIntercept che la funzione dicomread non utilizza correttamente.\nIl volume, una volta caricato in un array, può essere visualizzato in MATLAB tramite la\nfunzione ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"l6ANhvle6P"},{"type":"inlineCode","value":"sliceViewer","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"N66ynvTBXe"},{"type":"text","value":". In Python, una visualizzazione equivalente di un volume può essere effettuata utilizzando\nviewer interattivi come ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"IriJUg2naO"},{"type":"strong","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"napari","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"W6VeLVahjZ"}],"key":"bzp1qa1211"},{"type":"text","value":" (visualizzazione slice-by-slice lungo i diversi assi), oppure tramite strumenti di plotting come ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"FFkYpOlNkb"},{"type":"strong","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"matplotlib","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"d5ti5Nl4Tu"}],"key":"o5OFjxfnQm"},{"type":"text","value":" per visualizzare singole slice.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"iiVwabeeBH"}],"key":"E6hzVEiiGu"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Scorrendo le slides si individua nella prima la trachea (Figura 3.72), che esplorando il volume si suddivide nei due rami bronchiali principali. Il segnale all’interno dell’albero bronchiale è quello dell’aria quindi intorno al valore ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Ac8UwVCs56"},{"type":"inlineMath","value":"H = -1000","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo>=</mo><mo>−</mo><mn>1000</mn></mrow><annotation encoding=\"application/x-tex\">H = -1000</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1000</span></span></span></span>","key":"ev7wlTz0t2"},{"type":"text","value":".","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"KrqaKWO4vc"}],"key":"UulXPnclFh"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-72-0f0e82ce7b6d63520bd176a0149dc2b7.png","alt":"trachea-bronchi","key":"lSzachgHws","urlSource":"./images/image-72.png"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Figura 3.72. Trachea e rami bronchiali principale.","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"nYLpUWmmxK"}],"key":"gMA2jB2iEX"}],"key":"XVYl3eFIXq"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Il volume ottenuto caricando i dati DICOM in generale non sarà isotropo. E quindi necessario verificare se il volume è isotropo (voxel cubici) ed in caso contrario interpolarlo in modo da ottenere dei voxel cubici. L’interpolazione si effettua mantenendo costante il FOV dell’immagine (dimensione voxel x numero voxel nelle tre dimensioni). Tipicamente si pone la dimensione del voxel del volume interpolato pari alla dimensione del pixel (massima risoluzione).","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"Cm3TWDjTHD"}],"key":"NWRzDzwgJ7"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Volendo segmentare il lume dei bronchi, è ragionevole utilizzare un algoritmo di tipo region growing che parta da un seed da definire al livello della trachea. MATLAB non implementa l’algoritmo di ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"Uo3HjhbBYp"},{"type":"emphasis","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"region growing","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"GJOjVIJl0s"}],"key":"ip3cctpX1b"},{"type":"text","value":" in 3D, per cui è necessario\nimplementare questa funzione. Come esempio si fornisce la funzione ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"nHu0ILIXV2"},{"type":"inlineCode","value":"regionGrowing3D","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"lPPiQFrvNN"},{"type":"text","value":".\nLa funzione prende in ingresso l’immagine 3D, la tolleranza dell’algoritmo e il seed e\nrestituisce la maschera dell’oggetto segmentato. In Python, un’implementazione analoga del ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"FEZLI8FZjo"},{"type":"emphasis","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"region growing","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"z75ggFvJJ7"}],"key":"vmRW3XFxFg"},{"type":"text","value":" 3D può essere realizzata\nutilizzando funzioni della libreria ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"HgwRHhDka0"},{"type":"strong","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"scikit-image","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"poWStxKVhi"}],"key":"n2JDDsyWhI"},{"type":"text","value":", ad esempio ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"L63qK7GNFM"},{"type":"inlineCode","value":"skimage.segmentation.flood","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"KDMRZ4fNs4"},{"type":"text","value":",\nche supporta dati multidimensionali. In questo caso, la funzione riceve in ingresso il\nvolume 3D, la tolleranza (criterio di similarità) e le coordinate del seed, e restituisce\nla maschera binaria dell’oggetto segmentato.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"d6j4mitWnk"}],"key":"VwnHVPc5Kl"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Come si osserva la funzione utilizza come riferimento per il valore di segnale la media del segnale sulla segmentazione effettuata fino ad un certo punto del ciclo. L’intorno può essere definito come un cubo (26 connessioni) o una sfera (6 connessioni). È naturalmente possibile modificare la funzione per ottimizzare le prestazioni. La funzione è lenta (qualche minuto) quindi una volta effettuata la segmentazione è opportuno salvare la maschera in modo da poterla caricare per ottimizzare le operazioni seguenti. Il risultato dell’algoritmo di region growing sarà una maschera del tipo in Figura 3.73.","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"eCnyTJMOJW"}],"key":"NNMM7xySI2"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-73-d43ea46c704269ab01ca38da4dadcffa.png","alt":"trachea-bronchi","key":"sLinHK63cc","urlSource":"./images/image-73.png"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"Figura 3.73. Risultato dell’algoritmo region growing sull’albero bronchiale.","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"aOQIoRT2zi"}],"key":"jCl9lCLRV6"}],"key":"MPmY1RmBIA"},{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"La maschera ottenuta deve essere raffinata attraverso l’uso di filtri che eliminino eventuali “buchi” dovuti alla mancata inclusione di alcuni voxel. Infatti, pixel di background spuri all’interno della maschera farebbero fallire l’algoritmo di skeletonization. La funzione ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"X9ykmVD0xi"},{"type":"inlineCode","value":"bwmorph3","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"TVrdrVwAZH"},{"type":"text","value":" di MATLAB implementa alcuni algoritmi di filtraggio morfologico,\ntra cui le operazioni ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"tz9YkwKsng"},{"type":"inlineCode","value":"'fill'","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"dDpJu34wp1"},{"type":"text","value":" e ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Eb1TH3wdHq"},{"type":"inlineCode","value":"'majority'","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Q81bjRWlyh"},{"type":"text","value":", particolarmente adatte allo scopo.\nIn alternativa, è possibile eseguire un algoritmo di ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Im0Nb2B3am"},{"type":"emphasis","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"labeling","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"sBr8sZxpIj"}],"key":"cSvdBgk2yf"},{"type":"text","value":" sul background e\nidentificare i “buchi” nella maschera come tutti i blob eccetto quello di dimensione\nmaggiore. In Python, funzionalità analoghe possono essere ottenute utilizzando la libreria ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"onm9MaYm6M"},{"type":"strong","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"SciPy","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"qeC56QkeTH"}],"key":"ZzS8cM0wUE"},{"type":"text","value":"\ne ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"ewAzjv6b4j"},{"type":"strong","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"scikit-image","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"m2MyzxoFsg"}],"key":"BIyTG2G2Gu"},{"type":"text","value":". In particolare, un filtraggio di tipo ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"OkBNoREvgU"},{"type":"emphasis","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"majority","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"ZguOt9sYEN"}],"key":"DsILAVr8WY"},{"type":"text","value":" può essere implementato\ntramite la funzione ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"s5DJLozeft"},{"type":"inlineCode","value":"scipy.ndimage.generic_filter","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"cZXqJgh1PV"},{"type":"text","value":", definendo opportunamente una funzione\ndi majority voting. Nella soluzione adottata, il filtraggio è stato realizzato utilizzando\n","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"gF89wK6YJ9"},{"type":"inlineCode","value":"generic_filter","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"SrtJcQnNuQ"},{"type":"text","value":" con ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"pMC8gi8jWd"},{"type":"inlineCode","value":"function=majority_filter","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Nza2h1lPkJ"},{"type":"text","value":". Dove","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"IVHsNOJauX"}],"key":"ZpDfKKJEn1"},{"type":"code","lang":"python","value":"def majority_filter(window):\n    return 1 if np.sum(window) > (len(window) / 2) else 0","position":{"start":{"line":70,"column":1},"end":{"line":73,"column":1}},"key":"CvgPdDVuyJ"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"Ottenuta la maschera dell’albero bronchiale, la ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"k815KlHmDN"},{"type":"emphasis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"centerline","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"iWeCdaRLOP"}],"key":"G5O5VAeIGk"},{"type":"text","value":" può essere estratta tramite\nun algoritmo di ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"CG2Z92sBCo"},{"type":"emphasis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"skeletonization","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"v7bAydKYvH"}],"key":"x7m4BPlzfe"},{"type":"text","value":". In MATLAB tale operazione è implementata dalla funzione\n","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"xMiiLmD5re"},{"type":"inlineCode","value":"bwskel","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"usbuQkvjaO"},{"type":"text","value":". Per ottenere uno scheletro più “pulito” è disponibile l’opzione\n","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"qTgQ7uYXZo"},{"type":"inlineCode","value":"MinBranchLength","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"sDz07aYTWl"},{"type":"text","value":", che consente di definire la lunghezza minima dei rami dello scheletro.\nLo scheletro risultante è simile a quello mostrato in figura e la funzione restituisce\nuna maschera binaria dei voxel appartenenti allo scheletro. In Python, un’operazione equivalente di ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"vwGjxMS7Af"},{"type":"emphasis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"skeletonization","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"HDlpbFLbPz"}],"key":"KhiAgwGMKz"},{"type":"text","value":" 3D può essere effettuata\nutilizzando funzioni della libreria ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"VaEbgXmCPe"},{"type":"strong","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"scikit-image","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"UCNmZ1b3R0"}],"key":"xtKXgrbxaG"},{"type":"text","value":", come ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"xzNYC9pWAX"},{"type":"inlineCode","value":"skimage.morphology.skeletonize","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"GIMBaJApJ5"},{"type":"text","value":"\n(per dati binari) oppure ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"VaMEdTaYxq"},{"type":"inlineCode","value":"skimage.morphology.medial_axis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"T100G9H3Yj"},{"type":"text","value":", che restituisce anche informazioni\nsulla distanza dal contorno. La rimozione di rami corti (analoga a ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"e56QpHgg79"},{"type":"inlineCode","value":"MinBranchLength","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"jdDRu29wlo"},{"type":"text","value":")\npuò essere implementata tramite operazioni di ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"eVlN59cWdx"},{"type":"emphasis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"labeling","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"HDXn55B1Ha"}],"key":"BVf2S8PcAc"},{"type":"text","value":" e filtraggio basato sulla lunghezza\ndei rami dello scheletro.","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"BlZD6prwIE"}],"key":"jOzNIoIcLs"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":94,"column":1}},"children":[{"type":"text","value":"Una volta ottenuto lo scheletro, in MATLAB la funzione ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"f2bF93nxBn"},{"type":"inlineCode","value":"bwmorph3","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"jp37Nsyf11"},{"type":"text","value":" consente di eseguire\nulteriori elaborazioni. Le opzioni ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"gJPFkGppoi"},{"type":"inlineCode","value":"'clean'","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"mQ9IPGFBvE"},{"type":"text","value":", ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"ZD8zYa9T39"},{"type":"inlineCode","value":"'fill'","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"L978DFI5HP"},{"type":"text","value":" e ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"qqURStpoaP"},{"type":"inlineCode","value":"'remove'","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"MgCWRsYoye"},{"type":"text","value":" permettono di\nraffinare la forma dello scheletro, mentre l’opzione ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"kHI12Kx2VQ"},{"type":"inlineCode","value":"'endpoints'","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"fp3BRD1IF9"},{"type":"text","value":" restituisce i punti\nterminali dello scheletro. In Python, funzionalità analoghe possono essere realizzate\ncombinando operazioni di morfologia e ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"zP59NtYzBs"},{"type":"emphasis","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"labeling","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"UsIsXczkMe"}],"key":"k8sAAw6Caz"},{"type":"text","value":" in ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"h6cvzDqDvZ"},{"type":"strong","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"SciPy","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"dzEgVCju5i"}],"key":"gXfSIcN62y"},{"type":"text","value":" e ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"WIqY09N213"},{"type":"strong","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"scikit-image","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"Bepga1gLSj"}],"key":"IhDd2UdmWg"},{"type":"text","value":"; in\nparticolare, i punti terminali dello scheletro possono essere individuati analizzando\nla connettività locale dei voxel scheletrici e utilizzati per identificare l’inizio e\nla fine di un tratto dell’albero bronchiale.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"mRwnDhw0at"}],"key":"Lwg3Sy1xqF"},{"type":"paragraph","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"Un esempio dello scheletro dell’albero ottenuto è in Figura 3.74.","position":{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},"key":"XR98gf7HFX"}],"key":"VYjx5Kh1nb"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-74-2c8d64a37675e4b8496636be29b61635.png","alt":"skel","key":"bYfxEDii9r","urlSource":"./images/image-74.png"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Figura 3.74. Scheletro.","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"DSkssY9ntd"}],"key":"EkhD99AuzT"}],"key":"d5USgtSB8s"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"Per la misura del diametro del lume si adopera il metodo della sfera (Figura 3.75), che viene utilizzato nella caratterizzazione di condotti cavi quali i vasi sanguigni. Nel metodo della sfera si considera il diametro del lume pari al diametro della massima sfera con centro situato nel centro di simmetria del vaso (nel nostro caso definito dallo scheletro) inscrivibile nel vaso stesso. In termini algoritmici la sfera è inscrivibile se tutti i suoi voxel appartengono alla maschera del lume.","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"xnROcIdV8J"}],"key":"YcO9AhtQAY"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-75-e8abb9ad76e6957e3b94bb8d854d7f37.png","alt":"metodo-sfera","key":"XaxsoXT1SR","urlSource":"./images/image-75.png"},{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Figura 3.75. Metodo della sfera.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"GcOkzS7f0f"}],"key":"UszGFX7aBH"}],"key":"Tf9Jqszy5N"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"L’algoritmo per ogni punto della ‘centerline’ prova ad inscrivere sfere di raggio via via maggiore fino a quando la sfera non oltrepassa la maschera del lume. A quel punto memorizza il diametro dell’ultima sfera inscritta.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"Egw4cbj6kI"}],"key":"zN71k3GlcY"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"Definire la centerline su cui fare la misura per una struttura ramificata come l’albero bronchiale non è banale visto che il numero di percorsi possibili è alto. Di solito si utilizza un approccio simile a quello di Canny per la costruzione dei contorni dalle maschere in cui si tiene conto della distanza dei punti e della direzione di propagazione. Può essere utile la funzione strel che genera un kernel 3D di forma sferica.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"dcftmFT7Sb"}],"key":"LARJ3iuVec"},{"type":"paragraph","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"Nel nostro caso possiamo semplificare il problema partendo da un ramo terminale dello scheletro (coordinata z alta) ed andare ad includere punti dello scheletro andando a cercare in modo iterativo il punto più vicino e cancellando dalla lista i punti con valore della coordinata z minore di quella del punto inserito (Figura 3.76).","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"XuBvCunTjO"}],"key":"el0itLHOaD"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-76-8b4a4538b1fabfd7ee1bb584b1e53afc.png","alt":"centerline","key":"bGUI4fukWq","urlSource":"./images/image-76.png"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"Figura 3.76. Stima della centerline.","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"xsIhHGYe6U"}],"key":"tt68WzncIk"}],"key":"hsnG66LPqS"},{"type":"paragraph","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"text","value":"La variazione del diametro lungo la centerline partendo dalla trachea dovrebbe risultare un grafico di questo tipo, con un diametro della trachea dell’ordine dei 15-18 mm ed un diametro dei bronchi primari dell’ordine dei 10-12 mm. Un possibile risultato è riportato in Figura 3.77.","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"Tyz9fhPK8p"}],"key":"uft1DvNYz0"},{"type":"image","style":{"width":"100%"},"url":"/elab_bioimmagini-site/build/image-77-ee96757de24ae47a30c72994e4fa5aac.png","alt":"centerline","key":"msvwsW3Q1v","urlSource":"./images/image-77.png"},{"type":"paragraph","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"Figura 3.77. Risultato.","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"lEtLCxqeLj"}],"key":"qU457QGS49"}],"key":"SEzGOAqCOt"}],"key":"n75Hrjtxaq"}],"key":"ewv8hUXebu"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Esercitazione 5: segmentazione del grasso sottocutaneo e viscerale","url":"/z-3-3-esercitazione","group":"Capitolo3"},"next":{"title":"Capitolo 4: Validazione degli Algoritmi di Analisi dell’Immagine Biomedica","url":"/c14-imm-biom","group":"Capitolo4"}}},"domain":"http://localhost:3000"}