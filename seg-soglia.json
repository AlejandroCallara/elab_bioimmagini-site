{"version":3,"kind":"Notebook","sha256":"b957b04fd275eff9cc3588a4e17883b519e7ee9f4ef3299dfc674b3f31def8e6","slug":"seg-soglia","location":"/capitolo3/seg_soglia.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"seg_soglia.ipynb","url":"/elab_bioimmagini-site/build/seg_soglia-b715458ca91f03af212239703655fa73.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom skimage.filters import threshold_otsu\nfrom sklearn.cluster import k_means\nimport pydicom\nfrom pyclustering.cluster.center_initializer import kmeans_plusplus_initializer\nfrom pyclustering.cluster.fcm import fcm","key":"LjEkXTHSHx"},{"type":"outputs","id":"IhWbC4vQtKaH8POiQ4VIN","children":[],"key":"dfX1L0VE8R"}],"key":"v60Qmyf8yR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# load image\nds = pydicom.dcmread('../data/phantom.dcm')\nimage = ds.pixel_array\nprint(ds)\n\n# get histogram\np = np.max(image, None)\nprint(p)\ncounts, bins = np.histogram(image, bins = p)\n\n# display phantom image and image histogram\nfig, ax = plt.subplots(1,2)\nax[0].imshow(image, cmap = \"gray\")\nax[1].plot(counts[1:]/np.sum(counts, None))\nax[0].set_title('image')\nax[1].set_title('histogram')\nplt.show()\n\n# manual segmentation of water signal (dall'isto sopra 200 e sotto 600)\nmask = np.zeros((ds.Rows, ds.Columns), None)\nprint(mask.shape)\n\nid = np.logical_and(image > 200, image<600)\nmask[id] = 255\nplt.figure()\nplt.imshow(mask, cmap = \"gray\")\nplt.title('manual')\nplt.show()\n\n# otsu algorithm\notsu_thresh = threshold_otsu(image)\nimage_otsu = image > otsu_thresh\nplt.figure()\nplt.imshow(image_otsu, cmap = 'gray')\nplt.title('otsu')\nplt.show()\n\n#### kmeans ####\nx = image.reshape((-1,1))\ncentroid, label, inertia = k_means(x, n_clusters = 3)\nimage_classes = label.reshape(image.shape)\nplt.figure()\nplt.imshow(image_classes, cmap = 'gray')\nplt.title('kmeans')\nplt.show()\nc = np.sort(centroid, axis = 0)\nT = np.array([np.mean(c[0:2]), np.mean(c[1:3])])\nprint(\"soglie = \", T)\n\n#### fuzzy cmeans ####\n# initialize centers\ninitial_centers = kmeans_plusplus_initializer(x, 3, kmeans_plusplus_initializer.FARTHEST_CENTER_CANDIDATE).initialize()\n\n# create instance of Fuzzy C-Means algotirhm\nfcm_instance = fcm(x, initial_centers)\n\n# run cluster analysis and obtain results\nfcm_instance.process()\nclusters = fcm_instance.get_clusters()\ncenters = fcm_instance.get_centers()\n\nmask1 = np.zeros_like(x)\nmask1[clusters[0]]=1\nmask1 = mask1.reshape(image.shape)\nmask2 = np.zeros_like(x)\nmask2[clusters[1]]=1\nmask2 = mask2.reshape(image.shape)\nmask3 = np.zeros_like(x)\nmask3[clusters[2]]=1\nmask3 = mask3.reshape(image.shape)\nfig, ax = plt.subplots(1,3)\nax[0].imshow(mask1)\nax[1].imshow(mask2)\nax[2].imshow(mask3)\nax[0].set_title('fcm - cluster 1')\nax[1].set_title('fcm - cluster 2')\nax[2].set_title('fcm - cluster 3')\nplt.show()\n\n\n","key":"rx5cAU6Ike"},{"type":"outputs","id":"Cir1yZx8uiYXNiUUT6cy2","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Dataset.file_meta -------------------------------\n(0002,0000) File Meta Information Group Length  UL: 192\n(0002,0001) File Meta Information Version       OB: b'\\x00\\x01'\n(0002,0002) Media Storage SOP Class UID         UI: MR Image Storage\n(0002,0003) Media Storage SOP Instance UID      UI: 1.2.840.113619.2.134.1762810675.1868.1068286415.435\n(0002,0010) Transfer Syntax UID                 UI: Explicit VR Little Endian\n(0002,0012) Implementation Class UID            UI: 0.0.0.0\n(0002,0013) Implementation Version Name         SH: 'NOTSPECIFIED'\n(0002,0016) Source Application Entity Title     AE: 'NOTSPECIFIED'\n-------------------------------------------------\n(0008,0005) Specific Character Set              CS: 'ISO_IR 100'\n(0008,0008) Image Type                          CS: ['ORIGINAL', 'PRIMARY', 'OTHER']\n(0008,0012) Instance Creation Date              DA: '20031108'\n(0008,0013) Instance Creation Time              TM: '122956'\n(0008,0014) Instance Creator UID                UI: 0.0.0.0\n(0008,0016) SOP Class UID                       UI: MR Image Storage\n(0008,0018) SOP Instance UID                    UI: 1.2.840.113619.2.134.1762810675.1868.1068286415.435\n(0008,0020) Study Date                          DA: '20031108'\n(0008,0021) Series Date                         DA: '20031108'\n(0008,0022) Acquisition Date                    DA: '20031108'\n(0008,0023) Content Date                        DA: '20031108'\n(0008,0030) Study Time                          TM: '111335'\n(0008,0031) Series Time                         TM: '115239'\n(0008,0032) Acquisition Time                    TM: '115239'\n(0008,0033) Content Time                        TM: '115239'\n(0008,0050) Accession Number                    SH: ''\n(0008,0060) Modality                            CS: 'MR'\n(0008,0070) Manufacturer                        LO: 'GE MEDICAL SYSTEMS'\n(0008,0080) Institution Name                    LO: 'CLIN PHYS INST CNR PISA'\n(0008,0090) Referring Physician's Name          PN: ''\n(0008,0201) Timezone Offset From UTC            SH: '-0100'\n(0008,1010) Station Name                        SH: 'GEMSOW'\n(0008,1030) Study Description                   LO: 'prova fantoccio pet'\n(0008,103E) Series Description                  LO: 'fast spin echo'\n(0008,1060) Name of Physician(s) Reading Study  PN: 'vince'\n(0008,1090) Manufacturer's Model Name           LO: 'GENESIS_SIGNA'\n(0010,0010) Patient's Name                      PN: 'fantoccio PET'\n(0010,0020) Patient ID                          LO: 'I Test firb pet-MRI'\n(0010,0030) Patient's Birth Date                DA: '19640101'\n(0010,0040) Patient's Sex                       CS: 'M'\n(0010,1010) Patient's Age                       AS: '039Y'\n(0010,1030) Patient's Weight                    DS: '80'\n(0010,21B0) Additional Patient History          LT: ''\n(0018,0020) Scanning Sequence                   CS: 'SE'\n(0018,0021) Sequence Variant                    CS: 'SK'\n(0018,0022) Scan Options                        CS: 'FAST_GEMS'\n(0018,0023) MR Acquisition Type                 CS: '2D'\n(0018,0025) Angio Flag                          CS: 'N'\n(0018,0050) Slice Thickness                     DS: '3'\n(0018,0080) Repetition Time                     DS: '2000'\n(0018,0081) Echo Time                           DS: '12'\n(0018,0083) Number of Averages                  DS: '1'\n(0018,0084) Imaging Frequency                   DS: '6.38641e+08'\n(0018,0085) Imaged Nucleus                      SH: 'H1'\n(0018,0086) Echo Number(s)                      IS: '1'\n(0018,0087) Magnetic Field Strength             DS: '15000'\n(0018,0088) Spacing Between Slices              DS: '3'\n(0018,0091) Echo Train Length                   IS: '2'\n(0018,0093) Percent Sampling                    DS: '100'\n(0018,0094) Percent Phase Field of View         DS: '100'\n(0018,0095) Pixel Bandwidth                     DS: '122.07'\n(0018,1000) Device Serial Number                LO: '0000000A5114260'\n(0018,1020) Software Versions                   LO: '09'\n(0018,1050) Spatial Resolution                  DS: '1.77083'\n(0018,1088) Heart Rate                          IS: '0'\n(0018,1090) Cardiac Number of Images            IS: '0'\n(0018,1094) Trigger Window                      IS: '0'\n(0018,1100) Reconstruction Diameter             DS: '340'\n(0018,1250) Receive Coil Name                   SH: 'BODY'\n(0018,1251) Transmit Coil Name                  SH: 'BODY'\n(0018,1310) Acquisition Matrix                  US: [192, 0, 0, 192]\n(0018,1312) In-plane Phase Encoding Direction   CS: 'COL'\n(0018,1314) Flip Angle                          DS: '90'\n(0018,1315) Variable Flip Angle Flag            CS: 'N'\n(0018,1316) SAR                                 DS: '0.731095'\n(0018,5100) Patient Position                    CS: 'FFS'\n(0020,000D) Study Instance UID                  UI: 1.2.840.113619.2.134.1762810675.1868.1068286415.281\n(0020,000E) Series Instance UID                 UI: 1.2.840.113619.2.134.1762810675.1868.1068286415.422\n(0020,0010) Study ID                            SH: '5656'\n(0020,0011) Series Number                       IS: '6'\n(0020,0012) Acquisition Number                  IS: '2'\n(0020,0013) Instance Number                     IS: '13'\n(0020,0032) Image Position (Patient)            DS: [-173.415, -171.951, -4.04878]\n(0020,0037) Image Orientation (Patient)         DS: [1, 0, 0, 0, 1, 0]\n(0020,0052) Frame of Reference UID              UI: 1.2.840.113619.2.134.1762810675.1904.1068285971.930\n(0020,0060) Laterality                          CS: ''\n(0020,0110) Temporal Resolution                 DS: '0'\n(0020,1040) Position Reference Indicator        LO: 'SN'\n(0020,1041) Slice Location                      DS: '-4.0487804413'\n(0020,4000) Image Comments                      LT: Array of 109 elements\n(0028,0002) Samples per Pixel                   US: 1\n(0028,0004) Photometric Interpretation          CS: 'MONOCHROME2'\n(0028,0010) Rows                                US: 256\n(0028,0011) Columns                             US: 256\n(0028,0030) Pixel Spacing                       DS: [1.32812, 1.32812]\n(0028,0100) Bits Allocated                      US: 16\n(0028,0101) Bits Stored                         US: 16\n(0028,0102) High Bit                            US: 15\n(0028,0103) Pixel Representation                US: 1\n(0028,0120) Pixel Padding Value                 SS: 0\n(0028,1050) Window Center                       DS: '464'\n(0028,1051) Window Width                        DS: '928'\n(7FE0,0010) Pixel Data                          OW: Array of 131072 elements\n928\n"},"children":[],"key":"RipjmKm56f"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6fed19b5b711294b14f5f3d727036a50","path":"/elab_bioimmagini-site/build/6fed19b5b711294b14f5f3d727036a50.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"XgAOKbMaFT"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"(256, 256)\n"},"children":[],"key":"cSwCzBfTs2"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aca241731c58b6f37dc2437bdccca845","path":"/elab_bioimmagini-site/build/aca241731c58b6f37dc2437bdccca845.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"HdVWMQZwLn"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ea5e208c07789cef4158449acf8b1901","path":"/elab_bioimmagini-site/build/ea5e208c07789cef4158449acf8b1901.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"wH9VvT1yee"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a17e8b6807c0dee8ba9e96cdaeeecb7c","path":"/elab_bioimmagini-site/build/a17e8b6807c0dee8ba9e96cdaeeecb7c.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"HCeezpJyFo"},{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"soglie =  [204.35383932 589.24759294]\n"},"children":[],"key":"CGmtsmlVQy"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"11ccefdc5455275cde97fc303db78bca","path":"/elab_bioimmagini-site/build/11ccefdc5455275cde97fc303db78bca.png"},"text/plain":{"content":"<Figure size 640x480 with 3 Axes>","content_type":"text/plain"}}},"children":[],"key":"OC1qAjLYHW"}],"key":"wMyhzzXHdH"}],"key":"gW7UqYh2Zg"}],"key":"nm0jDBgDoN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Seg Contorni","url":"/seg-contorni","group":"Capitolo3"},"next":{"title":"Watershed Example","url":"/watershed-example","group":"Capitolo3"}}},"domain":"http://localhost:3000"}