{"version":3,"kind":"Notebook","sha256":"a84e11b70d442d918fd01cdfdc1ffac19fad3ac17837d2bde221a952cb65ae78","slug":"esempio-em-gmm","location":"/capitolo3/esempio_em_gmm.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"esempio_em_gmm.ipynb","url":"/elab_bioimmagini-site/build/esempio_em_gmm-18bc804a51e4c212b54c93cd196f4899.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.cluster import k_means\nfrom sklearn.mixture import GaussianMixture","key":"WQnkgrvYcn"},{"type":"outputs","id":"Xd00O1rL7XM3jBiNRix88","children":[],"key":"AW3jk9KWpz"}],"key":"b6ojVX30gJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dim = 512\ntissueMask = np.zeros((dim, dim), dtype = np.float32)\ntissueMask[:,:] = 1\ntissueMask[49:189,49:189] = 2\ntissueMask[199:499,199:349] = 3\n\nfig, ax = plt.subplots()\nax.imshow(tissueMask, cmap = \"gray\")\nax.set_title('image')\n\n# create 3 guassian distributions\nm1, m2, m3 = 50, 400, 200\nsd1, sd2, sd3 = 60, 40, 20\n\ndata1 = m1+sd1*np.random.randn(dim, dim) # signal distribution\ndata2 = m2+sd2*np.random.randn(dim, dim)\ndata3 = m3+sd3*np.random.randn(dim, dim)\nid1 = np.where(tissueMask == 1)\nid2 = np.where(tissueMask == 2)\nid3 = np.where(tissueMask == 3)\n\nimage = np.zeros_like(tissueMask)\nimage[id1] = data1[id1]\nimage[id2] = data2[id2]\nimage[id3] = data3[id3]\n\nfig, ax = plt.subplots()\nax.imshow(image, cmap = \"gray\")\nax.set_title(\"image\")\n\n# probability of a tissue in the image\np1 = len(id1)/(dim*dim)\np2 = len(id2)/(dim*dim)\np3 = len(id3)/(dim*dim)\n\n# calculate histogram\nfig, ax = plt.subplots(1,2)\ncounts, bins = np.histogram(image, bins = 256)\nxcounts = bins[:-1] + np.diff(bins) / 2\nax[0].plot(xcounts,counts)\n\n# apply gaussian mixtures using kmeans as initial condition\nimage = image.reshape((-1,1))\ngmm = GaussianMixture(\n    n_components = 3, \n    max_iter = 100, \n    init_params = 'kmeans', \n    verbose = 1)\ngmm.fit(image)\n\nn_samples = len(image)\n\ndataGM1 = gmm.means_[0]+np.sqrt(gmm.covariances_[0])*np.random.randn(int(gmm.weights_[0] * n_samples)).flatten()\ndataGM2 = gmm.means_[1]+np.sqrt(gmm.covariances_[1])*np.random.randn(int(gmm.weights_[1] * n_samples)).flatten()\ndataGM3 = gmm.means_[2]+np.sqrt(gmm.covariances_[2])*np.random.randn(int(gmm.weights_[2] * n_samples)).flatten()\ndataGM = np.concatenate([dataGM1.T, dataGM2.T, dataGM3.T])\n\nhGM, edgesGM = np.histogram(dataGM, bins = 256)\nxGM = edgesGM[:-1] + np.diff(edgesGM) / 2\nax[1].plot(xcounts,counts)\nax[1].plot(xGM,hGM, color='r')\n\n","key":"QJfz09NL7b"},{"type":"outputs","id":"pHWnqRhpnHZpF2kveZwee","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Initialization 0\n  Iteration 10\nInitialization converged.\n"},"children":[],"key":"OU471LpDlO"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"290f192491f353d7fb185aad23064e9a","path":"/elab_bioimmagini-site/build/290f192491f353d7fb185aad23064e9a.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"FFdSPySY6I"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"dad54906b45f25b2cf9466bf0644e4c7","path":"/elab_bioimmagini-site/build/dad54906b45f25b2cf9466bf0644e4c7.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"aWmsRcvo50"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"732da8ad87f913ab7d65b8f97fa93614","path":"/elab_bioimmagini-site/build/732da8ad87f913ab7d65b8f97fa93614.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"RoXLXJ6s6d"}],"key":"Ln9scN7clU"}],"key":"RRg7VW6Pkm"}],"key":"rOnJSZGLxZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Connected Tree Example","url":"/connected-tree-example","group":"Capitolo3"},"next":{"title":"Esempio Fcm","url":"/esempio-fcm","group":"Capitolo3"}}},"domain":"http://localhost:3000"}