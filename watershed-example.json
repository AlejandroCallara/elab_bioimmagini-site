{"version":3,"kind":"Notebook","sha256":"0618f7603e3f3310b21723d76965dda9f42569b20abc361fab28f30ddedae55e","slug":"watershed-example","location":"/capitolo3/watershed_example.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":".venv (3.12.9)","language":"python"},"numbering":{"title":{"offset":1}},"exports":[{"format":"ipynb","filename":"watershed_example.ipynb","url":"/elab_bioimmagini-site/build/watershed_example-3a8b1041dda56e79d05fb1502777b894.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\nimport numpy as np\nimport matplotlib\nmatplotlib.use(\"QtAgg\")  # keep if you need interactive window in VS Code\n\nimport matplotlib.pyplot as plt\nimport pydicom\nfrom skimage.segmentation import flood\n\nI = pydicom.dcmread('../data/phantom.dcm').pixel_array.astype(np.float32)\ndim = I.shape[0]\nmaxImage = int(I.max())\n\narea = np.zeros(maxImage + 1, dtype=np.int64)\nprofile = I[:, dim//2]\n\nfig, axes = plt.subplots(1, 3, figsize=(18, 6))\nplt.ion()\nplt.show(block=False)\n\n# --- (0) overlay panel: create once ---\naxes[0].set_title(\"Threshold Overlay\")\nim_base = axes[0].imshow(I, cmap='gray')\noverlay = np.zeros((dim, dim, 4), dtype=np.float32)   # RGBA\noverlay[..., 0] = 1.0                                 # red\noverlay[..., 3] = 0.0                                 # alpha updated each iter\nim_overlay = axes[0].imshow(overlay)\naxes[0].axis(\"off\")\n\n# --- (1) area curve: create once ---\naxes[1].set_title(\"Segmented Area vs Threshold\")\naxes[1].set_xlim(0, maxImage)\naxes[1].set_ylim(0, I.size)\nline_area, = axes[1].plot([], [], 'r', linewidth=2.0)\n\n# --- (2) profile + threshold line: create once ---\naxes[2].set_title(\"Profile with Threshold\")\naxes[2].set_xlim(0, dim-1)\naxes[2].set_ylim(profile.min(), profile.max())\naxes[2].plot(profile, 'k')\nhline = axes[2].axhline(0, color='r', alpha=0.2)\n\n# Update frequency (visualization only)\nstep = 5   # show every 5 thresholds (set 1 for every frame)\n\nfor th in range(1, maxImage):\n    BW = flood(I, (4, 4), tolerance=th)\n    area[th] = BW.sum()\n\n    # only refresh the figure sometimes (big speedup)\n    if th % step != 0:\n        continue\n\n    overlay[..., 3] = BW.astype(np.float32) * 0.30\n    im_overlay.set_data(overlay)\n\n    line_area.set_data(np.arange(1, th+1), area[1:th+1])\n    hline.set_ydata([th, th])\n\n    fig.canvas.draw_idle()\n    plt.pause(0.1)\n\nplt.ioff()\nplt.show()\ndisplay()\n","key":"HdL7o201St"},{"type":"outputs","id":"i7JfwmxG6BVko3zoBmAgE","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"2026-01-12 14:16:36.707 Python[4089:130701] +[IMKClient subclass]: chose IMKClient_Modern\n2026-01-12 14:16:36.707 Python[4089:130701] +[IMKInputSession subclass]: chose IMKInputSession_Modern\n"},"children":[],"key":"ckbOFMy3fx"}],"key":"rfZAyY4Mnl"}],"key":"W9ObfA37D9"}],"key":"KzX723pMjq"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Seg Soglia","url":"/seg-soglia","group":"Capitolo3"}}},"domain":"http://localhost:3000"}